%
% This document contains the chapter about synthesizing circuits.
%
% Copyright (C) 2005, 2006 Stefan Jahn <stefan@lkcc.org>
% Copyright (C) 2005 Michael Margraf <Michael.Margraf@alumni.TU-Berlin.DE>
%
% Impedance matching and attenuator synthesis update:
% Copyright (C) 2018 Andres Mart√≠nez-Mera <andresmartinezmera@gmail.com>
%
% Permission is granted to copy, distribute and/or modify this document
% under the terms of the GNU Free Documentation License, Version 1.1
% or any later version published by the Free Software Foundation.
%

\chapter{Synthesizing circuits}
\label{sec:synthesis}

\section{Attenuators}

Attenuators are used to damp a signal. Using pure ohmic resistors
the circuit can be realized for a very high bandwidth, i.e. from
DC to many GHz. The power attenuation $0 < L\le 1$ is defined as:
\begin{equation}
\label{eqn:loss}
L = \dfrac{P_{in}}{P_{out}}
  = \dfrac{V_{in}^2}{Z_{in}}\cdot\dfrac{Z_{out}}{V_{out}^2}
  = \left( \dfrac{V_{in}}{V_{out}}\right)^2 \cdot\dfrac{Z_{out}}{Z_{in}}
\end{equation}
where $P_{in}$ and $P_{out}$ are the input and output power and
$V_{in}$ and $V_{out}$ are the input and output voltages.

\subsection{Pi type attenuator}
\subsubsection{Design equations}

\begin{figure}[ht]
\begin{center}
\includegraphics[width=5cm]{picircuit}
\end{center}
\caption{$\pi$-topology of an attenuator}
\label{fig:pi_attenuator}
\end{figure}
\FloatBarrier

Fig. \ref{fig:pi_attenuator} shows an attenuator using the
$\pi$-topology. The conductances can be calculated as follows.
\begin{align}
Y_2 & = \dfrac{L - 1}{2\cdot \sqrt{L\cdot Z_{in}\cdot Z_{out}}} \\
Y_1 & = Y_2\cdot\left( \sqrt{\dfrac{Z_{out}}{Z_{in}}\cdot L} - 1 \right) \\
Y_3 & = Y_2\cdot\left( \sqrt{\dfrac{Z_{in}}{Z_{out}}\cdot L} - 1 \right)
\end{align}
where $Z_{in}$ and $Z_{out}$ are the input and output reference
impedances, respectively. The $\pi$-attenuator can be used for an
impedance ratio of:
\begin{equation}
\dfrac{1}{L} \le \dfrac{Z_{out}}{Z_{in}} \le L
\end{equation}

\noindent However, in practice, it is more useful to calculate the resistor values from the attenuation coefficient in dB units \cite{Vizmuller}:

\begin{figure}[ht]
\begin{center}
\includegraphics[width=6cm]{bitmaps/synthesis/attenuators/Pi-Attenuator-Schematic.eps}
\end{center}
\caption{Schematic of a $\pi$-type attenuator}
\label{fig:pi_attenuator_schematic}
\end{figure}


\begin{equation}
 R_{1} = \frac{1}{\frac{10^{\frac{\alpha}{10}}+1}{Z_{in} \cdot (10^{\frac{\alpha}{10}}-1)} - \frac{1}{R_{2}}}
\end{equation}

\begin{equation}
 R_{2} = \frac{10^{\frac{\alpha}{10}}-1}{2} \cdot \sqrt{\frac{Z_{in}\cdot Z_{out}}{10^{\frac{\alpha}{10}}}}	
\end{equation}

\begin{equation}
 R_{3} = \frac{1}{\frac{10^{\frac{\alpha}{10}}+1}{Z_{out} \cdot (10^{\frac{\alpha}{10}}-1)} - \frac{1}{R_{2}}}
\end{equation}


\subsubsection{Power dissipation equations}

The power dissipated by the resistors in steady state regime can be easily obtained using basic circuit analysis techniques.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=10cm]{bitmaps/synthesis/attenuators/Pi-Type-Power-Dissipation}
\end{center}
\caption{Node and branch names used in the power dissipation formulae for the $\pi$-type attenuator}
\label{fig:pi_attenuator_power_dissipation}
\end{figure}
\FloatBarrier

\noindent In what follows, $P_{Rx}$ will denote the mean power dissipated by $Rx$ in steady state. The power dissipated by $R_1$ is given by:

\begin{equation}
P_{R1} = \dfrac{V_{in}^2}{R_{1}}, \;\;\;\; V_{1} = V_{in}, V_{in} = \sqrt{P_{in}\cdot Z_{in}}  \Rightarrow P_{R1} = \dfrac{P_{in} \cdot Z_{in}}{R_{1}}
\end{equation}

\noindent Prior to calculate the power dissipated by $R_2$, it is needed to derive the expression which relates $I_{2}$ with circuit parameters:

\begin{equation}
I_{2} = I_{in} - I_{1}, I_{1} = \dfrac{V_{1}}{R_{1}} = \dfrac{\sqrt{P_{in} \cdot Z_{in}}}{R_{1}} \Rightarrow I_{2} = \sqrt{\dfrac{P_{in}}{Z_{in}}} - \dfrac{\sqrt{P_{in} \cdot Z_{in}}}{R_{1}}
\end{equation}

\noindent Thus,
\begin{equation}
P_{R2} = I_{2}^2 \cdot R_{2} = \left( \sqrt{\dfrac{P_{in}}{Z_{in}}} - \dfrac{\sqrt{P_{in} \cdot Z_{in}}}{R_{1}} \right)^2 \cdot R_{2} = P_{in} \cdot R_{2} \cdot \dfrac{(R_{1} - Z_{in})^2}{R_{1}^2 \cdot Z_{in}}
\end{equation}

\noindent Finally, for $R_{3}$:
\begin{equation}
P_{R3} = \dfrac{V_{out}^2}{R_{3}} = \dfrac{(V_{in} - I_{2} \cdot R_{2})^2}{R_{3}} = \dfrac{\left( \sqrt{P_{in} \cdot Z_{in}} - R_{2}\cdot\left( \sqrt{\dfrac{P_{in}}{Z_{in}}} - \dfrac{\sqrt{P_{in} \cdot Z_{in}}}{R_{1}}\right) \right)^2}{R_{3}}
\end{equation}

\noindent After some simplification:
\begin{equation}
P_{R3} = P_{in} \cdot \dfrac{(R_{1} \cdot R_{2} - Z_{in} \cdot (R_{1} + R_{2}))^2}{R_{1}^2 \cdot R_{3} \cdot Z_{in}}
\label{eq:Pi_DissP_R3}
\end{equation}

\noindent From  \ref{eq:Pi_DissP_R3}, the attenuation factor may be expressed in terms of the resistor values and the input and output impedances as follows:

\begin{equation}
\alpha = 10\cdot log_{10} \left( \dfrac{P_{out}}{P_{in}}\right) = 20\cdot log_{10} \left( \dfrac{(R_{1} \cdot R_{2} - Z_{in} \cdot (R_{1} + R_{2}))}{R_{1} \cdot \sqrt{ R_{3} \cdot Z_{in}}} \right)
\end{equation}

\clearpage
\subsection{Tee-type attenuator}
\subsubsection{Design equations}

\begin{figure}[ht]
\begin{center}
\includegraphics[width=5cm]{tcircuit}
\end{center}
\caption{T-topology of an attenuator}
\label{fig:t_attenuator}
\end{figure}
\FloatBarrier

Fig. \ref{fig:t_attenuator} shows an attenuator using the
T-topology. The resistances can be calculated as follows.
\begin{align}
Z_2 & = \dfrac{2\cdot \sqrt{L\cdot Z_{in}\cdot Z_{out}}}{L - 1} \\
Z_1 & = Z_{in}\cdot A - Z_2 \\
Z_3 & = Z_{out}\cdot A - Z_2 \\
\textrm{with} \qquad A & = \dfrac{L + 1}{L - 1}
\end{align}
where $L$ is the attenuation ($0 < L\le 1$) according to
equation \ref{eqn:loss} and $Z_{in}$ and $Z_{out}$
are the input and output reference impedance, respectively.
The T-attenuator can be used for an impedance ratio of:
\begin{equation}
\dfrac{Z_{out}}{Z_{in}} \le \dfrac{(L+1)^2}{4\cdot L}
\end{equation}

\noindent The expression which relate the resistor values with the attenuation coefficient in dB units are given below \cite{Vizmuller}:

\begin{figure}[ht]
\begin{center}
\includegraphics[width=6cm]{bitmaps/synthesis/attenuators/Tee-Attenuator-Schematic.eps}
\end{center}
\caption{Schematic of a tee-type attenuator}
\label{fig:tee_attenuator_schematic}
\end{figure}

\begin{equation}
R_{1} = Z_{in} \cdot  \frac{10^{\frac{\alpha}{10}}+1}{10^{\frac{\alpha}{10}}-1} - R_{2}
\end{equation}

\begin{equation}
R_{2} = \dfrac{2 \cdot \sqrt{Z_{in} \cdot Z_{out} \cdot 10^{\frac{\alpha}{10}}}}{10^{\frac{\alpha}{10}} - 1}
\end{equation}

\begin{equation}
R_{3} = Z_{out} \cdot  \frac{10^{\frac{\alpha}{10}}+1}{10^{\frac{\alpha}{10}}-1} - R_{2}
\end{equation}

\subsubsection{Power dissipation equations}

\noindent As in the $\pi$-type attenuator case, the power dissipated by the tee-type attenuator resistors may be calculated using the Ohm's law:

\begin{figure}[ht]
\begin{center}
\includegraphics[width=10cm]{bitmaps/synthesis/attenuators/Tee-Type-Power-Dissipation}
\end{center}
\caption{Node and branch names used in the power dissipation formulae for the tee-type attenuator}
\label{fig:tee_attenuator_power_dissipation}
\end{figure}
\FloatBarrier

\noindent The power dissipated by $R_{1}$ is given by:

\begin{equation}
P_{R1} = I_{1}^2 \cdot R_{1} = \dfrac{P_{in} \cdot R_{1}}{Z_{in}}
\end{equation}

\noindent Similarly, for $R_{2}$:

\begin{equation}
P_{R2} = \dfrac{V_{1}^2}{R_{2}}, V_{1} = V_{in} - I_{1} \cdot R_{1} \Rightarrow P_{R2} = \dfrac{(V_{in} - I_{1}\cdot R_{1})^2}{R_{2}}
\end{equation}

\begin{equation}
P_{R2} = \dfrac{\left( \sqrt{P_{in} \cdot Z_{in}} - R_{1}\cdot \sqrt{\dfrac{P_{in}}{Z_{in}}}\right)^2}{R_2} = P_{in} \cdot \dfrac{(R_{1}-Z_{in})^2}{R_{2} \cdot Z_{in}}
\end{equation}

\noindent Finally, the power dissipated by $R_{3}$ is calculated from the output current, $I_3$:

\begin{equation}
P_{R3} = I_{3}^2 \cdot R_{3}
\label{eq:PR3-Tee}
\end{equation}

\noindent where $I_{3}$ can be calculated as follows:

\begin{equation}
I_3 = I_1 - I_2 = \sqrt{\dfrac{P_{in}}{Z_{in}}} - \dfrac{V_{1}}{R_{2}} = \sqrt{\dfrac{P_{in}}{Z_{in}}} - \dfrac{\sqrt{P_{in} \cdot Z_{in}} - R_{1} \cdot \sqrt{\dfrac{P_{in}}{Z_{in}}}}{R_{2}}
\label{eq:I3_Tee}
\end{equation}

\noindent Now, $P_{R3}$ is obtained by replacing \ref{eq:I3_Tee} into \ref{eq:PR3-Tee}:

\begin{equation}
P_{R3} = \left( \sqrt{\dfrac{P_{in}}{Z_{in}}} - \dfrac{\sqrt{P_{in} \cdot Z_{in}} - R_{1} \cdot \sqrt{\dfrac{P_{in}}{Z_{in}}}}{R_{2}} \right)^2 \cdot R_{3}
\end{equation}

\noindent After some simplification work:

\begin{equation}
P_{R3} = \dfrac{R_3 \cdot (R_1 + R_2 - Z_{in})^2}{Z_{in} \cdot R_{2}^2}
\end{equation}

\subsection{Some common properties between $\pi$ and tee-type attenuators}

\noindent The following table summarizes the power dissipation equations of the $\pi$-type and  tee-type attenuators:

\begin{center}
\begin{tabular}{| c | c | c| }
\hline 
 & \textbf{$\pi$-type attenuator} & \textbf{Tee-type attenuator} \\ \hline                        
$P_{R1}$ & $ P_{in}\cdot \dfrac{Z_{in}}{R_1}$ &  $ P_{in}\cdot \dfrac{R_1}{Z_{in}}$ \\ \hline  
$P_{R2}$ & $P_{in}\cdot \dfrac{R_2 \cdot (R_1 - Z_{in})^2}{R_1^2 \cdot Z_{in}}$ & $P_{in}\cdot \dfrac{ (R_1 - Z_{in})^2}{R_2 \cdot Z_{in}}$ \\ \hline  
$P_{R3}$ & $P_{in} \cdot \dfrac{(R_1 \cdot R_2 - Z_{in} \cdot (R_1 + R_2))^2}{R_1^2 \cdot R_3 \cdot Z_{in}}$ & $P_{in} \cdot \dfrac{R_3 \cdot (R_1 + R_2 - Z_{in})^2}{Z_{in} \cdot R_2^2}$  \\   
\hline  
\end{tabular}
\end{center}

\noindent Despite the fact that the equations above are different for the $\pi$- and tee-type networks, the power dissipated by the resistors is the same in both attenuator types as long as $Z_{in} = Z_{out}$ (see Fig. \ref{fig:tee_pi_pow_diss_Zin_Zout_Z0}). However, this does not happen when $Z_{in} \neq Z_{out}$ (see Fig. \ref{fig:tee_pi_pow_diss_Zin_50_Zout_75}). Notice that $R_{1}$ is the resistor which dissipates more power for attenuation values above $~7dB$:

\begin{figure}[ht]
\begin{center}
\includegraphics[width=10cm]{bitmaps/synthesis/attenuators/Relative-dissipated-power-pi-tee-Zin-Zout-Z0}
\end{center}
\caption{Relative power dissipated by each resistors in $\pi$- and tee-type attenuators where $Z_{in} = Z_{out} = 50 \Omega$}
\label{fig:tee_pi_pow_diss_Zin_Zout_Z0}
\end{figure}
\FloatBarrier

\begin{figure}[ht]
\begin{center}
\includegraphics[width=10cm]{bitmaps/synthesis/attenuators/Relative-dissipated-power-pi-tee-Zin-50-Zout-75}
\end{center}
\caption{Relative power dissipated by each resistors in $\pi$- and tee-type attenuators where $Z_{in} = 50\Omega, Z_{out} = 75 \Omega$}
\label{fig:tee_pi_pow_diss_Zin_50_Zout_75}
\end{figure}
\FloatBarrier

\noindent The minimum achievable attenuation using $\pi$- and tee-type attenuators depends on the ratio between the input and output impedances and it can be calculated as follows \cite{Vizmuller}:
\begin{equation}
\alpha_{min} = 20 \cdot log_{10} \left( \sqrt{\dfrac{Z_{in}}{Z_{out}}} + \sqrt{\dfrac{Z_{in}}{Z_{out}}+1}\right)
\end{equation}

\begin{figure}[ht]
\begin{center}
\includegraphics[width=10cm]{bitmaps/synthesis/attenuators/Minimum_Synthesizable_Att_Pi_Tee}
\end{center}
\caption{Minimum synthesizable attenuation using $\pi$- and tee-type attenuators}
\label{fig:tee_pi_min_att}
\end{figure}
\FloatBarrier

\clearpage
\subsection{Bridged-tee attenuator}
\subsubsection{Design equations}

\noindent Unlike $\pi$- and tee-type attenuators, the bridged-tee network requires that $Z_{in} = Z_{out} = Z_{0}$. The design equations are the following \cite{Vizmuller}:

\begin{equation}
R_{1} = Z_{0} \cdot \left( 10^{\frac{\alpha}{20}} -1 \right)
\end{equation}

\begin{equation}
R_{4} = \dfrac{Z_{0}}{  10^{\frac{\alpha}{20}} -1 }
\end{equation}

\begin{figure}[ht]
\begin{center}
\includegraphics[width=5cm]{bitmaps/synthesis/attenuators/Bridged-Tee-Schematic}
\end{center}
\caption{Schematic of a bridged-tee attenuator}
\label{fig:bridged_pow_diss_Zin_50_Zout_75}
\end{figure}
\FloatBarrier

\subsubsection{Power dissipation equations}

\noindent The power dissipated by the resistors can be calculated using the Kirchhoff's laws:

\begin{equation}
P_{R1} = P_{in} \cdot \dfrac{4\cdot R_1\cdot R_4^2 \cdot Z_0}{ (R_1 \cdot R_4 + Z_0 \cdot (2 \cdot R_4 + Z_0))^2}
\end{equation}

\begin{equation}
P_{R2} = P_{in} \cdot \dfrac{(R_1 \cdot R_4 + Z_0^2)^2 }{ (R_1 \cdot R_4 + Z_0 \cdot (2 \cdot R_4 + Z_0))^2}
\end{equation}

\begin{equation}
P_{R3} = 0
\end{equation}

\begin{equation}
P_{R4} = P_{in} \cdot \dfrac{4\cdot R_4\cdot Z_0^3}{ (R_1 \cdot R_4 + Z_0 \cdot (2 \cdot R_4 + Z_0))^2}
\end{equation}

\noindent Notice that $R_3$ does not dissipate power. However, it is required for the output impedance matching. Figure \ref{fig:bridged-tee_pow_diss_Z0_50} shows the relative power dissipated by each resistor with respect to the input power:

\begin{figure}[ht]
\begin{center}
\includegraphics[width=10cm]{bitmaps/synthesis/attenuators/Relative-dissipated-power-bridged-tee-50}
\end{center}
\caption{Relative power dissipated by each resistors in a bridged-tee attenuator where $Z_{0} = 50\Omega$}
\label{fig:bridged-tee_pow_diss_Z0_50}
\end{figure}
\FloatBarrier

\clearpage
\subsection{Reflection attenuator}
\subsubsection{Design equations}
\begin{figure}[ht]
\begin{center}
\includegraphics[width=6cm]{bitmaps/synthesis/attenuators/Reflection-Attenuator-Power-Dissipation}
\end{center}
\caption{Schematic of a reflection attenuator with some relavant S-parameters annotations}
\label{fig:reflec-attenuator-schematic}
\end{figure}
\FloatBarrier

\noindent The attenuation properties of the reflection attenuator can be derived using the S-parameter properties of an ideal 3-dB coupler. In this sense, $S_{21}$ and the attenuation coefficient, $\alpha$, may be expressed in terms of $R_i$ and $Z_0$:


\begin{align}
S_{21} & = S_{31} \cdot (-S_{33}) \cdot S_{23} + S_{41} \cdot (-S_{44}) \cdot S_{24} = \left( \dfrac{Z_0 - R_i}{Z_0 + R_i} \right) \cdot (S_{31} \cdot S_{23} + S_{41} \cdot S_{24}) \\
 & = \left( \dfrac{Z_0 - R_i}{Z_0 + R_i} \right) \cdot \left( \dfrac{1}{\sqrt{2}} \cdot \dfrac{e^{j \dfrac{\pi}{2}}}{\sqrt{2}} + \dfrac{1}{\sqrt{2}} \cdot \dfrac{e^{j \dfrac{\pi}{2}}}{\sqrt{2}} \right) = \left( \dfrac{Z_{0} - R_{i}}{Z_{0} + R_{i}}\right) \cdot e^{j\dfrac{\pi}{2}}
\end{align}


\begin{equation}
\alpha = -20\cdot log_{10} (\abs{S_{21}}) = -20\cdot log_{10} \left(\abs*{\dfrac{Z_0 - R_i}{Z_0 + R_i}} \right)
\end{equation}

\noindent Now, it is possible to find the value of $R_{i}$ for the certain attenuation $\alpha$:

\begin{equation}
10^{-\frac{\alpha}{20}} = \abs*{\dfrac{Z_0 - R_i}{Z_0 + R_i}} \iff (Z_0 + R_i) \cdot 10^{-\dfrac{\alpha}{20}} = \abs{Z_{0} - R_i}
\end{equation}

\nointent There are two solutions for $R_i$:
\bigskip

\noindent If $R_i < Z_0$:
\begin{equation}
R_i = Z_0 \cdot \dfrac{1 - 10^{-\frac{\alpha}{20}}}{1 + 10^{-\frac{\alpha}{20}}}
\end{equation}

\noindent If $R_i > Z_0$:
\begin{equation}
R_i = Z_0 \cdot \dfrac{1 + 10^{-\frac{\alpha}{20}}}{1 - 10^{-\frac{\alpha}{20}}}
\end{equation}

\subsubsection{Power dissipation equations}

The power dissipated by the resistors can be calculated in terms of the difference between the incident power and the reflected-back power.
Because of the symmetry of the 3dB coupler, the power dissipated by both resistors is the same:

\begin{equation}
P_{inc} = P_{in} \cdot \abs{S_{i1}}^2
\end{equation}

\begin{equation}
P_{refl} = P_{in} \cdot \abs{S_{ii}}^2
\end{equation}

\begin{equation}
P_{diss} = P_{inc} - P_{refl} = P_{in} \cdot \abs{S_{i1}}^2 \cdot \left( 1 - \abs{S_{ii}}^2\right)
\end{equation}

\noindent where $S_{ii} = \frac{Z_0 - R_i}{Z_0 + R_i}$ and $\abs{S_{i1}} = \frac{1}{\sqrt{2}}$

\noindent Thus, 

\begin{equation}
P_{diss} = \dfrac{P_{in}}{2} \cdot \left( \dfrac{Z_0 - R_i}{Z_0 + R_i}\right) = \dfrac{P_{in}}{2} \cdot \left( 1 - 10^{-\frac{\alpha}{10}}\right)
\end{equation}



\begin{figure}[ht]
\begin{center}
\includegraphics[width=8cm]{bitmaps/synthesis/attenuators/Relative-dissipated-reflection-attenuator}
\end{center}
\caption{Relative power dissipated by each resistors in a reflection attenuator where $Z_{0} = 50\Omega$}
\label{fig:reflec-attenuator-pow-diss}
\end{figure}
\FloatBarrier

\clearpage
\subsection{Quarter-wavelength series attenuator}
\subsubsection{Design equations}
\noindent The response of the quarter-wavelength series attenuator can be derived using the ABCD-parameters of the branches marked in Fig. \ref{fig:qw-series-att-schematic}. That way, the ABCD-parameters are converted into S-parameters and finally, the attenuation coeffient may be expressed in terms of the circuit parameters.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=8cm]{bitmaps/synthesis/attenuators/QW-Series-Attenuator-Schematic}
\end{center}
\caption{Schematic of a quarter-wavelength series attenuator}
\label{fig:qw-series-att-schematic}
\end{figure}
\FloatBarrier


\begin{gather}
 Y_{1} = 
 \begin{bmatrix} 1 & 0 \\ \dfrac{1}{R + Z_0} & 1 \end{bmatrix}
\end{gather}

\noindent The ABCD matrix of a quarter-wavelength transmission line is given by \ref{eq:trasmission_line_general}:

\begin{gather}
 A_{QW} = 
 \begin{bmatrix} 0 & j \cdot Z_0 \\ \dfrac{j}{Z_0} & 0 \end{bmatrix}
\end{gather}

\begin{gather}
 Y_{2} = 
 \begin{bmatrix} 1 & 0 \\ \dfrac{1}{R} & 1 \end{bmatrix}
\end{gather}

\noindent Then, the ABCD matrix of the whole network is given by:

\begin{gather}
 ABCD = Y_{1} \cdot A_{QW} \cdot Y_{2} = j \cdot Z_0 \cdot 
 \begin{bmatrix} \dfrac{1}{R} & 1 \\ \left( \dfrac{1}{R \cdot (R + Z_0)} + \dfrac{1}{Z_0^2}\right) & \dfrac{1}{R+Z_0} \end{bmatrix}
\end{gather}

\noindent Using the formulae for the ABCD- to S-parameters conversion:

\begin{gather}
 S = 
 \begin{bmatrix} 0 & -j\cdot \dfrac{R}{R+Z_0} \\ -j\cdot \dfrac{R}{R+Z_0} & \dfrac{Z_0^2}{(R+Z_0)^2} \end{bmatrix}
\end{gather}

\noindent Notice that this is a not a symmetrical network since $S \cdot S^t \neq I$

\begin{equation}
\alpha = -10 \cdot log_{10} \left( \dfrac{R}{R+Z_0}\right)
\end{equation}

\noindent Finally,

\begin{equation}
R = \dfrac{Z_0}{10^{\frac{\alpha}{20}}-1}
\end{equation}


\noindent Notice also that the impedance inversion property of the $\lambda/4$-transmission line holds for narrowband applications. In this sense, the general (broadband) expressions for the S-parameters are rather complex and lie outside of the scope of this document. S-parameter simulation is preferred instead:

\begin{figure}[ht]
\begin{center}
\includegraphics[width=8cm]{bitmaps/synthesis/attenuators/qw-series-typical-response}
\end{center}
\caption{Typical response of an ideal quarter-wavelength series attenuator. The attenuation is degraded away from the center frequency because of the narrowband behavior of the transmission line}
\label{fig:qw-series-att-response}
\end{figure}
\FloatBarrier



\subsubsection{Power dissipation at $f_0$}

\begin{equation}
P_{R1} = I_1^2 \cdot R_1 = \left( \dfrac{V_{in}}{R_1 + Z_0} \right)^2 \cdot R_1 = \left( \dfrac{P_{in} \cdot Z_0}{(R_1 + Z_0)^2} \right) \cdot R_1
\end{equation}


\begin{equation}
P_{R2} = \dfrac{P_{in} \cdot Z_0^2}{(R_1 + Z_0)^2}
\end{equation}

\noindent The power delivered both to the load and to $R_3$ is denoted as $P_2$ and it may be calculated as follows:

\begin{equation}
P_2 = P_{in} - (P_{R1} + P_{R2}) = P_{in} - \left( \left( \dfrac{P_{in} \cdot Z_0}{(R1 + Z_0)^2} \right) \cdot \left( R_1 + Z_0\right) \right) = P_{in} \cdot \left( 1 - \dfrac{Z_0 \cdot (R_1 + Z_0)}{(R_1 + Z_0)^2} \right)
\end{equation}


\noindent $V_{out}$ is calculated as follows:
\begin{equation}
V_{out} = \sqrt{P_2 \cdot \left( \dfrac{R_3 \cdot Z_0}{R_3 + Z_0} \right)} = \sqrt{ P_{in} \cdot \left( \dfrac{Z_0 \cdot (R_1 \cdot Z_0)}{(R_1 + Z_0)^2} \right) \cdot \left( \dfrac{R_3 \cdot Z_0}{R_3 + Z_0}\right)}
\end{equation}

\noindent Thus, the power dissipated by $R_3$ is given by:

\begin{equation}
P_{R3} = \dfrac{V_{out}^2}{R_3} = \dfrac{P_{in} \cdot \left( \left( 1 - \dfrac{Z_0 \cdot (R_1 + Z_0)}{(R_1 + Z_0)^2}\right) \cdot \left( \dfrac{R_3 \cdot Z_0}{R_3 + Z_0}\right) \right)}{R_3}
\end{equation}

\noindent Since $R_1 = R_3 = R$,

\begin{equation}
P_{R1} = P_{R3} = P_{in} \cdot \dfrac{R \cdot Z_0}{(R + Z_0)^2}
\end{equation}


\begin{figure}[ht]
\begin{center}
\includegraphics[width=8cm]{bitmaps/synthesis/attenuators/Relative-dissipated-QW_series_Z0_50}
\end{center}
\caption{Relative power dissipated by each resistors in a quarter-wavelength series attenuator, $Z_{0} = 50\Omega$}
\label{fig:qw-series-attenuator-pow-diss}
\end{figure}
\FloatBarrier

\clearpage
\subsection{Quarter-wavelength shunt attenuator}


\subsubsection{Design equations}
\begin{figure}[ht]
\begin{center}
\includegraphics[width=8cm]{bitmaps/synthesis/attenuators/QW-Shunt-Attenuator-Schematic}
\end{center}
\caption{Schematic of a quarter-wavelength shunt attenuator}
\label{fig:qw-shunt-att-schematic}
\end{figure}
\FloatBarrier


\noindent The $\lambda/4$ transmission line behaves as an impedance inverter at $f_0$ such that its input impedance is $Z_{TL} = \dfrac{Z_0^2}{Z_L} $ where $Z_L$ is the impedance of the line termination. Thus, the admittance $Y_1$ can be calculated as follows:

\begin{equation}
Z_L = R_{eq} = \dfrac{R \cdot Z_0}{ R + Z_0} \rightarrow Z_{TL} = \dfrac{Z_0 \cdot (R + Z_0)}{R}
\end{equation}

\noindent and consequently, the ABCD matrix of the shunt branch is given by:

\begin{gather}
 Y_{1} = 
 \begin{bmatrix} 1 & 0 \\ \dfrac{R}{Z_0 \cdot (R + Z_0)} & 1 \end{bmatrix}
\end{gather}

\noindent Similarly, the ABCD matrix of the series resistor is:

\begin{gather}
 A_{2} = 
 \begin{bmatrix} 1 & R \\ 0 & 1 \end{bmatrix}
\end{gather}

\noindent Thus, the ABCD matrix of the cascade is given by:
\begin{gather}
 ABCD = Y_{1} \cdot A_{2} = \begin{bmatrix} 1 & R \\ \dfrac{R}{Z_0 \cdot (R + Z_0)} & 1 + \dfrac{R^2}{Z_0 \cdot (R + Z_0)} \end{bmatrix}
\end{gather}

\noindent Using the ABCD to S parameters conversion formulae:

\begin{gather}
 S = 
 \begin{bmatrix} 0 & \dfrac{Z_0}{R + Z_0} \\ \dfrac{Z_0}{R + Z_0} & \dfrac{R^2}{R + Z_0} \end{bmatrix}
\end{gather}


\noindent Now, the attenuation coefficient can be expressed in terms of R and $Z_0$:

\begin{equation}
\alpha = -10 \cdot log_{10} \left( \abs{S_{21}^2}\right) = -20 \cdot log_{10} \left(  \dfrac{Z_0}{R + Z_0}\right)
\end{equation}

\noindent And finally, the value of R for a given attenuation, $\alpha$, is given by:

\begin{equation}
R = Z_0 \cdot \left( 10^{\frac{\alpha}{20} - 1}\right)
\end{equation}

\subsubsection{Power dissipation at $f_0$}

\noindent According to the impedance inversion properties of the quarter-wavelength transmission line, the power dissipated by the shunt branch is:

\begin{equation}
P_{shunt} = \dfrac{V_{in}^2}{Z_{TL} } = P_{in} \cdot \dfrac{R}{R + Z_0}
\end{equation}

\noindent Consequently, $V_1$ may be expressed in terms of the input power as:

\begin{equation}
V_1 = \sqrt{P_{shunt} \cdot R_{eq}} = \sqrt{P_{shunt} \cdot \left( \dfrac{R \cdot Z_0}{R + Z_0}\right)} = \sqrt{P_{in} \cdot \dfrac{R}{R + Z_0} \cdot \dfrac{R \cdot Z_0}{R + Z_0}} = \dfrac{R \cdot \sqrt{P_{in} \cdot Z_0}}{R + Z_0}
\end{equation}

\noindent So, the power dissipation formulae for $R_2$ and $R_3$ are given by:

\begin{equation}
P_{R2} = \dfrac{V_1^2}{Z_0} = \dfrac{\dfrac{R \cdot \sqrt{P_{in} \cdot Z_0}}{R + Z_0}}{Z_0} = P_{in} \cdot \dfrac{R^2}{(R + Z_0)^2}
\end{equation}

\begin{equation}
P_{R3} = \dfrac{V_1^2}{R} = \dfrac{\dfrac{R \cdot \sqrt{P_{in} \cdot Z_0}}{R + Z_0}}{R} = P_{in} \cdot \dfrac{R \cdot Z_0}{(R + Z_0)^2}
\end{equation}

\noindent The mean current flowing through the shunt branch is $I_{1} = \dfrac{V_{in}}{Z_{TL}}$ and the current delivered by the source is $I_{in} = \sqrt{\dfrac{P_{in}}{Z_{TL}}}$. Thus, the current delivered to $R_1$ and to the load is $I_{2} = I_{in} - I_{1}$ and the power dissipated by $R_2$ is given by:

\begin{equation}
P_{R1} = P_{R3} = I_{2}^2 \cdot R = P_{in} \cdot \dfrac{R \cdot Z_0}{(R + Z_0)^2}
\end{equation}

\clearpage
\subsection{Lumped element equivalents of the $\lambda/4$ transmission line}

\noindent At low frequencies, a length of $\lambda/4$ may be impractical, so it would be convenient to find lumped-element impedance inverters which mimic the $\lambda/4$ line properties (at least at $f_0$). In this sense, it is possible to find such equivalent networks in both $\pi$ and tee configurations. The ABCD matrix of a (general) transmission line is:

\begin{gather}
  A_{TL} = 
 \begin{bmatrix} cosh(\gamma \cdot l) & Z_0 \cdot sinh(\gamma \cdot l) \\ \dfrac{1}{Z_0} \cdot sinh(\gamma \cdot l) & cosh(\gamma \cdot l) \end{bmatrix}
\label{eq:trasmission_line_general}
\end{gather}

\noindent where $\gamma = \alpha + j \cdot \beta$ is the propagation constant, $\alpha$ is the attenuation constant and $\beta = \dfrac{2\pi}{\lambda_0}$ is the wavenumber.
\medskip

\noindent Under the assumption that the transmission line is lossless, $\alpha = 0$ and because of the length of a $\lambda/4$ line, \ref{eq:trasmission_line_general} can be simplified as:

\begin{gather}
  A_{QW} = 
\begin{bmatrix} 0 & j \cdot Z_0 \\ \dfrac{j}{Z_0}  & 0 \end{bmatrix}
 \label{eq:qw-line}
\end{gather}

\subsubsection{$\pi$-type equivalent}

\noindent The ABCD-parameters of a $\pi$-type network is easily determined using the cascade property of the ABCD-parameters.

\begin{equation}
A_{\pi} = A_{shunt1} \cdot A_{series} \cdot A_{shunt2}
\end{equation}

\noindent where $A_{shunt1} = \begin{bmatrix} 1 & 0  \\ Y_1 & 1 \end{bmatrix}$, $A_{series} = \begin{bmatrix} 1 & Z_1  \\ 0 & 1 \end{bmatrix}$ and $A_{shunt2} = \begin{bmatrix} 1 & 0  \\ Y_2 & 1 \end{bmatrix}$

\noindent Thus,

\begin{gather}
  A_{\pi} = 
 \begin{bmatrix} Y_2 \cdot Z_1 + 1 & Z_1 \\ (Y_1 \cdot Z_1 + 1) \cdot Y_2 + Y_1 & Y_1 \cdot Z_1 + 1 \end{bmatrix}
 \label{eq:pi-network-equivalent}
\end{gather}

\noindent Since $A_{QW} = A_{\pi}$, we get the following equations system:

\begin{equation}
\begin{cases} Y_2 \cdot Z_1 + 1 = 0\\ Z_1 = j\cdot Z_0 \\ (Y_1 \cdot Z_1 + 1) \cdot Y_2 + Y_1 = \dfrac{j}{Z_0} \\ Y_1 \cdot Z_1 + 1 = 0\end{cases} 
\end{equation}

\noindent From the second equation, we get that $Z_1$ must be an inductor such that:

\begin{equation}
Z_1 = j\cdot \omega_0 \cdot L \Longrightarrow L = \dfrac{Z_0}{\omega_0}
\end{equation}

\noindent Now, from the first and the fourth equations, $Y_1 = Y_2$, so:

\begin{equation}
Y_1 \cdot j \cdot Z_0 + 1 = 0, Y_2 \cdot j \cdot Z_0 + 1 = 0 \iff Y_1 = Y_2 = \dfrac{j}{Z_0}
\end{equation}

\noindent So the shunt elements must be capacitors such that:

\begin{equation}
Y_1 = Y_2 = j \cdot \omega_0 \cdot C = \dfrac{j}{Z_0} \Longrightarrow C = \dfrac{1}{\omega_0 \cdot Z_0}
\end{equation}

\noindent Finally, $Y_1$, $Y_2$ and $Z_1$ may be substituted in the third equation to check they satisfy the whole equation system.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=8cm]{bitmaps/synthesis/attenuators/Pi-equivalent-l4}
\end{center}
\caption{$\pi$-type equivalent of a $\lambda/4$ line}
\label{fig:pi-eq-l4}
\end{figure}
\FloatBarrier

\subsubsection{Tee-type equivalent}

\noindent In case of the tee-type network, the ABCD matrix is given by: 

\begin{equation}
A_{tee} = A_{series1} \cdot A_{shunt} \cdot A_{shunt2}
\end{equation}

\noindent where $A_{series1} = \begin{bmatrix} 1 & Z_1  \\ 0 & 1 \end{bmatrix}$, $A_{shunt} = \begin{bmatrix} 1 & 0  \\ Y_1 & 1 \end{bmatrix}$ and $A_{series2} = \begin{bmatrix} 1 & Z_2  \\ 0 & 1 \end{bmatrix}$

\noindent Thus,

\begin{gather}
  A_{Tee} = 
 \begin{bmatrix} Y_1 \cdot Z_2 + 1 & Y_1 \\ (Y_1 \cdot Z_1 + 1) \cdot Z_2 + Z_1 & Y_1 \cdot Z_1 + 1 \end{bmatrix}
 \label{eq:tee-network-equivalent}
\end{gather}

\noindent Since $A_{QW} = A_{tee}$, we get the following equations system:

\begin{equation}
\begin{cases} Y_1 \cdot Z_2 + 1 = 0\\ Y_1 = j\cdot Z_0 \\ (Y_1 \cdot Z_1 + 1) \cdot Z_2 + Z_1 = \dfrac{j}{Z_0} \\ Y_1 \cdot Z_1 + 1 = 0\end{cases} 
\end{equation}

\noindent From the second equation, we get that $Y_1$ must be a capacitor such that:

\begin{equation}
Y_1 = j\cdot \omega_0 \cdot C \Longrightarrow C = \dfrac{Z_0}{\omega_0}
\end{equation}

\noindent Now, from the first and the fourth equations, $Z_1 = Z_2$, so:

\begin{equation}
j \cdot Z_0 \cdot Z_1 + 1 = 0, j \cdot Z_0 \cdot Z_2 + 1 = 0 \iff Z_1 = Z_2 = \dfrac{j}{Z_0}
\end{equation}

\noindent So the shunt elements must be inductors such that:

\begin{equation}
Z_1 = Z_2 = j \cdot \omega_0 \cdot L = \dfrac{j}{Z_0} \Longrightarrow L = \dfrac{1}{\omega_0 \cdot Z_0}
\end{equation}

\noindent Finally, $Z_1$, $Z_2$ and $Y_1$ may be substituted in the third equation to check they satisfy the whole equation system.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=8cm]{bitmaps/synthesis/attenuators/Tee-equivalent-l4}
\end{center}
\caption{Tee-type equivalent of a $\lambda/4$ line}
\label{fig:tee-eq-l4}
\end{figure}
\FloatBarrier

\clearpage
\subsection{Power unit conversion}

\noindent The attenuator synthesis tool can calculate the power dissipated by each resistor using different power units. In this sense, the present section collects the power unit conversions implemented.

\subsubsection{Conversion from W to dBm}
\begin{equation}
P_{dBm} = 10 \cdot log_{10} (P_{W} \cdot 10^{-3}) = 10 \cdot log_{10} (P_{W}) - 30
\end{equation}

\begin{equation}
P_{W} = 10^{\dfrac{P_{dBm}}{10}} + 30
\end{equation}

\subsubsection{Conversion from dBm to dBuV and dBmV}
\begin{equation}
P_{W} = \dfrac{V_{V}^2}{Z_{0}} = \dfrac{(V_{uV} \cdot 10^{6})^2}{Z_{0}} \Longrightarrow P_{dBuV} = 10 \cdot log_{10} \left( P_{W} \right) + 10 \cdot log_{10} \left( Z_0 \right) +120
\end{equation}

\begin{equation}
P_{W} = 10^{\dfrac{P_{dBuV} - 120 - 10\cdot log_{10} (Z_0)}{10}}
\end{equation}

\nointend Similarly, for the $dBmV$ case:

\begin{equation}
P_{W} = \dfrac{V_{V}^2}{Z_{0}} = \dfrac{(V_{mV} \cdot 10^{3})^2}{Z_{0}} \Longrightarrow P_{dBuV} = 10 \cdot log_{10} \left( P_{W} \right) + 10 \cdot log_{10} \left( Z_0 \right) + 60
\end{equation}

\begin{equation}
P_{W} = 10^{\dfrac{P_{dBuV} - 60 - 10\cdot log_{10} (Z_0)}{10}}
\end{equation}

\begin{landscape}
\thispagestyle{empty}
\newgeometry{right=-6cm,bottom=11cm}
\begin{table}[l]
\setlength{\tabcolsep}{10pt}
\begin{tabular}{|c|c|c|c|c|c|c|}
\hline
\textbf{from \textbackslash to} & \textbf{W}                        & \textbf{dBm}                  & \textbf{dBuV ($75\Omega$)}          & \textbf{dBmV ($75\Omega$)}         & \textbf{dBuV ($50\Omega$)}          & \textbf{dBmV ($50\Omega$)}       \\ \hline
\textbf{W}                      & \cellcolor[HTML]{C0C0C0}          & $10 \cdot log_{10} ( P_W)+30$ & $10 \cdot log_{10} ( P_W) + 138.75$ & $10 \cdot log_{10} ( P_W) + 78.75$ & $10 \cdot log_{10} ( P_W) + 136.99$ & $10 \cdot log_{10} ( P_W)+76.99$ \\ \hline
\textbf{dBm}                    & $10^{\frac{P_{dBm}}{10}} + 30$    & \cellcolor[HTML]{C0C0C0}      & $P_{dBuV}+108.75$                  & $P_{dBuV}+48.75$                  & $P_{dBuV}+106.99$                  & $P_{dBuV}+46.99 $               \\ \hline
\textbf{dBuV ($75\Omega$)}      & $10^{\frac{P_{dBuV}-138.75}{10}}$ & $P_{dBuV}-108.75$            & \cellcolor[HTML]{C0C0C0}            & $P_{dBmV} - 60$                   & $P_{dBuV}-1.76$                    & $P_{dBmV} - 61.76$              \\ \hline
\textbf{dBmV ($75\Omega$)}      & $10^{\frac{P_{dBuV}-78.75}{10}}$  & $P_{dBuV}-48.75$             &$ P_{dBmV} + 60 $                   & \cellcolor[HTML]{C0C0C0}           & $P_{dBmV} + 58.35 $                & $P_{dBmV} - 1.76$               \\ \hline
\textbf{dBuV ($50\Omega$)}      & $10^{\frac{P_{dBuV}-136.99}{10}}$ &$ P_{dBuV}-106.99 $           & $P_{dBuV} + 1.76$                  & $P_{dBuV} - 58.35 $               & \cellcolor[HTML]{C0C0C0}            & $P_{dBuV}-60 $                  \\ \hline
\textbf{dBmV ($50\Omega$)}      & $10^{\frac{P_{dBuV}-76.99}{10}}$  & $P_{dBuV}-46.99 $            & $P_{dBmV} + 61.76$                 & $P_{dBmV} + 1.76  $               &$P_{dBmV} + 60 $                   & \cellcolor[HTML]{C0C0C0}         \\ \hline
\end{tabular}
\caption{Summary of power unit conversion formulae}
\end{table}
\end{landscape}
\restoregeometry

\section{Filters}

One of the most common tasks in microwave technologies is to
extract a frequency band from others. Optimized filters exist
in order to easily create a filter with an appropriate characteristic.
The most popular ones are:

\addvspace{12pt}

\begin{tabular}{l|l}
Name & Property \\
\hline
Bessel filter (Thomson filter) & as constant group delay as possible \\
Butterworth filter (power-term filter) & as constant amplitude transfer function as possible \\
Chebychev filter type I & constant ripple in pass band \\
Chebychev filter type II & constant ripple in stop band \\
Cauer filter (elliptical filter) & constant ripple in pass and stop band \\
\end{tabular}

\addvspace{12pt}

From top to bottom the following properties increase:
\begin{itemize}
\item ringing of step response
\item phase distortion
\item steepness of amplitude transfer function at the beginning of the pass band
\end{itemize}

\addvspace{12pt}

The order $n$ of a filter denotes the number of poles of its (voltage)
transfer function. It is:
\begin{equation}
\text{slope of asymptote} = \pm\, n\cdot 20 \text{dB/decade}
\end{equation}
Note that this equation holds for all filter characteristics, but
there are big differences concerning the attenuation near the pass
band.


\subsection{LC ladder filters}

The best possibility to realize a filters in VHF and UHF bands are
LC ladder filters. The usual way to synthesize them is to first
calculate a low-pass (LP) filter and afterwards transform it into a
high-pass (HP), band-pass (BP) or band-stop (BS) filter. To do so,
each component must be transformed into another.

\addvspace{12pt}

In a low-pass filter, there are  parallel capacitors $C_{LP}$ and
series inductors $L_{LP}$ in alternating order. The other filter
classes can be derived from it:

\addvspace{12pt}

In a high-pass filter:
\begin{align}
C_{LP} \quad \rightarrow \quad & L_{HP} = \dfrac{1}{\omega_B^2\cdot C_{LP}} \\
L_{LP} \quad \rightarrow \quad & C_{HP} = \dfrac{1}{\omega_B^2\cdot L_{LP}}
\end{align}

\addvspace{12pt}

In a band-pass filter:
\begin{align}
C_{LP} \quad \rightarrow \quad & \text{parallel resonance circuit with} \\
                               & C_{BP} = \dfrac{C_{LP}}{\Delta\Omega} \\
                               & L_{BP} = \dfrac{\Delta\Omega}{\omega_1\cdot \omega_2\cdot C_{LP}} \\
L_{LP} \quad \rightarrow \quad & \text{series resonance circuit with} \\
                               & C_{BP} = \dfrac{\Delta\Omega}{\omega_1\cdot \omega_2\cdot L_{LP}} \\
                               & L_{BP} = \dfrac{L_{LP}}{\Delta\Omega}
\end{align}

\addvspace{12pt}

In a band-stop filter:
\begin{align}
C_{LP} \quad \rightarrow \quad & \text{series resonance circuit with} \\
       & C_{BP} = \dfrac{C_{LP}}{2\cdot\left| \dfrac{\omega_2}{\omega_1} - \dfrac{\omega_1}{\omega_2} \right| } \\
       & L_{BP} = \dfrac{1}{\omega^2\cdot \Delta\Omega\cdot C_{LP}} \\
L_{LP} \quad \rightarrow \quad & \text{parallel resonance circuit with} \\
       & C_{BP} = \dfrac{1}{\omega^2\cdot \Delta\Omega\cdot L_{LP}} \\
       & L_{BP} = \dfrac{L_{LP}}{2\cdot\left| \dfrac{\omega_2}{\omega_1} - \dfrac{\omega_1}{\omega_2} \right| }
\end{align}

\addvspace{12pt}

Where
\begin{align}
\omega_1 \quad\rightarrow\quad & \text{lower corner frequency of frequency band} \\
\omega_2 \quad\rightarrow\quad & \text{upper corner frequency of frequency band} \\
\omega   \quad\rightarrow\quad & \text{center frequency of frequency band} \quad \omega = 0.5\cdot (\omega_1 + \omega_2) \\
\Delta\Omega \quad\rightarrow\quad & \Delta\Omega = \dfrac{|\omega_2 - \omega_1|}{\omega}
\end{align}

\subsubsection{Butterworth}

The $k$-th element of an $n$ order Butterworth low-pass ladder filter is:
\begin{alignat}{3}
 & \text{capacitance:} \qquad & C_k = & \dfrac{X_k}{Z_0} \\
 & \text{inductance:}  \qquad & L_k = & X_k \cdot Z_0 \\
 & \text{with}         \qquad & X_k = & \dfrac{2}{\omega_B} \cdot \sin \dfrac{(2\cdot k + 1)\cdot\pi}{2\cdot n}
\end{alignat}

The order of the Butterworth filter is dependent on the specifications
provided by the user.  These specifications include the edge
frequencies and gains.
\begin{equation}
\label{eq:ButtOrder}
n = \dfrac{\log{\left(\dfrac{10^{-0.1\cdot \alpha_{stop}} - 1}{10^{-0.1\cdot \alpha_{pass}} - 1}\right)}}{2\cdot\log{\left(\dfrac{\omega_{stop}}{\omega_{pass}}\right)}}
\end{equation}

\subsubsection{Chebyshev I}

The equations for a Chebyshev type I filter are defined recursivly.
With $R_{dB}$ being the passband ripple in decibel, the $k$-th
element of an $n$ order low-pass ladder filter is:
\begin{alignat}{3}
 & \text{capacitance:} \qquad & C_k & = \dfrac{X_k}{Z_0} \\
 & \text{inductance:}  \qquad & L_k & = X_k \cdot Z_0 \\
 & \text{with}         \qquad & X_k & = \dfrac{2}{\omega_B}\cdot g_k \\
 & & r   & = \sinh\left( \frac{1}{n}\cdot\text{arsinh}\dfrac{1}{\sqrt{10^{R_{dB}/10} - 1}} \right) \\
 & & a_k & = \sin \dfrac{(2\cdot k + 1)\cdot\pi}{2\cdot n} \\
 & & g_k & =
\begin{cases}
\begin{array}{ll}
  \dfrac{a_k}{r} & \textrm{ for } \quad k=0\\
  \dfrac{a_{k-1}\cdot a_k}{g_{k-1}\cdot \left( r^2 + \sin^2\dfrac{k\cdot\pi}{n} \right)} & \textrm{ for } \quad k\ge 1
\end{array}
\end{cases} \\
 & & X_k & = \dfrac{2}{\omega_B}\cdot g_k
\end{alignat}

The order of the Chebychev filter is dependent on the specifications
provided by the user.  The general form of the calculation for the
order is the same as for the Butterworth, except that the inverse
hyperbolic cosine function is used in place of the common logarithm
function.
\begin{equation}
\label{eq:ChebOrder}
n = \dfrac{\textrm{sech}\left(\dfrac{10^{-0.1\cdot \alpha_{stop}} - 1}{10^{-0.1\cdot \alpha_{pass}} - 1}\right)}{2\cdot\textrm{sech}\left(\dfrac{\omega_{stop}}{\omega_{pass}}\right)}
\end{equation}

\subsubsection{Chebyshev II}

Because of the nature of the derivation of the inverse Chebychev approximation function from the standard Chebychev approximation the calculation of the order \eqref{eq:ChebOrder} is the same.

\subsection{Quarter-wavelength filters}

Quarter-wavelength filters are based on the fact that short and open $\lambda/4$ stubs are equivalent to series and paralell resonant tanks, respectively. Once given the normalized $g_i$ coefficients of the filter prototype, it is quite straighforward to obtain the impedance of the short/open stubs, depending on the desired filter mask (bandpass/notch). Figure \ref{eq:QWfilter} illustrates the topology of a quarter-wavelength filter.\\

\begin{figure}[h!]
\centering
\includegraphics[width=100mm]{QuarterWavelengthFilter}
\caption{Quarter-wavelength filters topology. a) Notch filter b) Bandpass filter \cite{Pozar}}
\label{eq:QWfilter}
\end{figure}

\noindent The impedance of the $i$-th stub, $Z_i$, is given by:

\begin{itemize}
\item{Bandpass (short circuit)} $Z_i = \frac{\pi Z_0 \Delta}{4g_i}$
\item{Notch (open circuit)} $Z_i = \frac{4 Z_0 }{g_i\pi \Delta}$
\end{itemize}

\noindent where $Z_0$ is the characteristic impedance of the filter (typically, 50$\Omega$) and $\Delta$ is the relative bandwidth defined as $\Delta = \frac{f_2 - f_1}{f_c}$. The demonstration \cite{Pozar} is not included in this document in favour of greater simplicity.

\noindent It has to be said that quarter-wavelength filters are narrowband by nature. Besides this, these kind of filters may not be feasible because of the stubs may require unpractical widths (i.e. impedances) for proper operation.


\section{Matching newtworks}
The purpose of a matching network is to transform an impedance into another (e.g. convert the impedance of a device to the characteristic impedance of a transmission line, $Z_0$) and play an important role in RF circuit design. The matching networks can be implemented with lumped components (typically in applications below $<$ 1GHz), but also with transmission lines (more common in the microwave band). The following sections show the basics of the most common matching network synthesis techniques as well as the design equations implemented in the Qucs impedance matching tool.

\subsection{L-section}
The \textit{L-section} method combines two reactances (shunt and series) to match any complex load impedance, $Z_L = R_L + jX_L$ to a source impedance, $Z_0$, (typically, $Z_0 = 50\Omega$) at a certain frequency. As shown in \ref{fig:Lsection}, eight different combinations of inductor and capacitor can be used depending on where $Z_L$ is located on the Smith chart.

\begin{figure}[H]
\centering
\includegraphics[width=120mm]{Lsection}
\caption{L-section topology}
\label{fig:Lsection}
\end{figure}

The series and the shunt reactances move $Z_L$ towards $Z_0$ through the impedance and admittance circles respectively. As shown at \ref{fig:LsectionSmith}, these eight combinations of series and shunt reactances provide the required degrees of freedom to move $Z_L$ to any other point in the Smith chart.


\begin{figure}[H]
\centering
\includegraphics[width=120mm]{SmithChart-Lsection}
\caption{Impedance traslation produced by a series/shunt capacitor and inductor}
\label{fig:LsectionSmith}
\end{figure}


\noindent The design equations for the \textit{L-section} method are the following:\\

if $\frac{R_L}{Z_0} > 1$

\begin{align}
B & = \frac{X_L \pm \sqrt{\frac{R_L}{Z_0}} \cdot \sqrt{R_L^2 + X_L^2 - Z_0\cdot R_L}}{R_L^2 + X_L^2} \\
X & = \frac{1}{B} + \frac{X_L \cdot Z_0}{R_L} - \frac{Z_0}{B \cdot R_L}
\end{align}

\noindent on the counterpart, if $\frac{R_L}{Z_0} < 1$

\begin{align}
X & = \pm \sqrt{R_L \cdot (Z_0 - R_L)} - X_L \\
B & = \pm \frac{(Z_0 - R_L)/R_L}{Z_0}
\end{align}


\noindent \textit{Reference:} \cite{Pozar}, pages 229-233.

\subsection{Single stub}

At microwave frequencies, transmission lines are usually preferred rather than lumped components. The simplest method to achieve narrowband matching with transmission lines is to use a stub and a transmission line.

\begin{table}[H]
  \centering
  \begin{tabular}{ | c | c | }
    \hline
    Open circuited stub & Short circuited stub\\ \hline
    \begin{minipage}{.4\textwidth}
      \includegraphics[width=\linewidth]{SingleStubOpen}
    \end{minipage}
    &
    \begin{minipage}{.4\textwidth}
      \includegraphics[width=\linewidth]{SingleStubShort}
    \end{minipage}
    \\ \hline
  \end{tabular}
  \caption{Single stub matching}
  \label{tbl:sngstub}
\end{table}


As \ref{fig:SmithTL} shows, a transmission line describes a circle around $Z_0$ whereas an open and a short circuited stub behave like a shunt capacitor and a shunt inductor respectively, which gives the necessary degrees of freedom to match any complex load, $Z_L$ to $Z_0$:

\begin{figure}[H]
\centering
\includegraphics[width=120mm]{SmithChartTL}
\caption{Impedance traslation caused by a transmission line and an open/short circuited stub}
\label{fig:SmithTL}
\end{figure}


\noindent Below are detailed the design equations for the \textit{single stub} technique, where the variables are the distance between the stub and the load, and the length of the stub. The impedance seen at the stub, $Z(d)$ is given by:

\begin{equation}
Z(d) = Z_0 \frac{Z_L + j\cdot Z_0\cdot tan(\beta \cdot d)}{Z_0 + j\cdot Z_L \cdot tan(\beta \cdot d)}
\end{equation}

\noindent where $\beta = \frac{2\pi}{\lambda}$ is the wave number and $d$ the distance between the load and the stub. The admittance at the stub is: $Y(d) = G(d)+j \cdot B(d)$, where G(d) is the conductance and B(d) the susceptance at d. It can be shown that:

\begin{equation}
G(d) = \frac{R_L \cdot (1 + tan^2(\beta \cdot d))}{R_L^2 + (X_L + Z_0\cdot tan(\beta \dot d))^2}
\end{equation}

\noindent and,

\begin{equation}
B(d) = \frac{R_L^2\cdot tan(\beta \cdot d) - (Z_0 - X_L\cdot tan(\beta \cdot d))\cdot (X_L + Z_0\cdot tan(\beta \cdot d))}{Z_0 \cdot (R_L^2 + (X_L + Z_0\cdot tan(\beta \cdot d))^2)}
\end{equation}

The conductance at the stub should be $G(d) = 1/Z_0$ so as to match the real part of the load to $Z_0$. Then, applying this condition and solving the previous equation for $t = tan(\beta \cdot d)$, it gives:

\begin{align}
R_L \neq Z_0 \;\;\;\;\;\;\;  t & = \frac{X_L \pm \sqrt{(R_L/Z_0) \cdot ((Z_0 - R_L)^2 + X_L^2)}}{R_L - Z_0} \\
R_L == Z_0 \;\;\;\;\;\;\;  t & = -X_L/(2\cdot Z_0)
\end{align}

\noindent Now, the susceptance of the stub should be calculated to cancel the reactive part of the load impedance, so $B_{stub} = -B(d)$.

\noindent Since $t=tan(\beta \cdot d)$, $d$ can be calculated as:

\begin{align}
\text{if t $\geq$ 0}\;\;\;\;\;\;\;  d & = \frac{\lambda}{2\pi} atan(t) \\
\text{if t $<$ 0}\;\;\;\;\;\;\;  d & = \frac{\lambda}{2\pi} (\pi + atan(t))
\end{align}

\noindent The length of the stub is given by:

\begin{align}
\text{Open circuited stub} \;\;\;\;\;\;\;  l_{open} & = \frac{-\lambda}{2\pi} atan\left(Z_0\cdot B(d)\right)  \\
\text{Short circuited stub}\;\;\;\;\;\;\;  l_{short} & = \frac{\lambda}{2\pi} atan\left(\frac{1}{Z_0\cdot B(d)}\right)
\end{align}

\noindent Finally, if needed, the stubs may be splitted into balanced stubs as follows:

\begin{table}[H]
  \centering
  \begin{tabular}{ | c | c | }
    \hline
    Open circuited balanced stubs & Short circuited balanced stubs\\ \hline
    \begin{minipage}{.4\textwidth}
      \includegraphics[width=\linewidth]{SingleStubOpenBalanced}
    \end{minipage}
    &
    \begin{minipage}{.4\textwidth}
      \includegraphics[width=\linewidth]{SingleStubShortBalanced}
    \end{minipage}
    \\ \hline
  \end{tabular}
  \caption{Single stub matching (balanced stubs)}\label{tbl:sngstubbalanced}
\end{table}

\noindent The length of the balanced stubs is given by the following equations \cite{SanDiegoNotesMatching}:

\begin{align}
\text{Open circuited stub:} \;\;\;\;\;\;\; l_{sb} & = \frac{\lambda}{2\pi} tan^{-1} \left( 2 tan\left( \frac{2\pi l_s}{\lambda}\right)\right) \\
\text{Short circuited stub:}\;\;\;\;\;\;\; l_{sb} & = \frac{\lambda}{2\pi} tan^{-1} \left( \frac{1}{2} tan\left( \frac{2\pi l_s}{\lambda}\right)\right)
\end{align}

where $l_{sb}$ and $l_{s}$ are the lengths of the unbalanced and balanced stubs respectively.\\

\noindent \textit{Reference:} \cite{Pozar}, pages 234-241.


\subsection{Double stub}
The distance between different blocks (e.g. amplifier stages, filters,...) in a board is determined by the transmission line, so the its length is not easily tunable in practice. Obviously, this fact locks one degree of freedom in the \textit{single stub} technique, making it less suitable. On the counterpart, the \textit{double stub} method keeps the length of the transmission line fixed, so tuning can be done simply by adjusting the length of the stubs. This is usually far more convenient since the stubs can be trimmered or elongated as needed. However, this technique comes with the disadvantage of having restrictions about the load to be matched, $Z_L$.

\begin{table}[H]
  \centering
  \begin{tabular}{ | c | c | }
    \hline
    Open circuited stub & Short circuited stub\\ \hline
    \begin{minipage}{.4\textwidth}
      \includegraphics[width=\linewidth]{DoubleStubOpen}
    \end{minipage}
    &
    \begin{minipage}{.4\textwidth}
      \includegraphics[width=\linewidth]{DoubleStubShort}
    \end{minipage}
    \\ \hline
  \end{tabular}
  \caption{Double stub matching}\label{tbl:dblstub}
\end{table}


The admittance at the first stub is $Y_1 = G_L + j(B_L + B_{stub_1})$, where $Y_L$, $B_L$ and $G_L$ have the same meaning as in the previous section. $B_{stub1}$ is the susceptance of the first stub.

The distance between the stubs, $d$, is typically fixed to $\lambda/8$. Under this condition, the admittance at the second stub is given by:

\begin{equation}
Y_2 = Y_0 \frac{G_L + j(B_L + B_{stub1} + Y_0 \cdot tan(\beta \cdot d))}{Y_0 + j (G_L + j(B_L + B_{stub1})) \cdot tan(\beta \cdot d)}
\end{equation}

\noindent The impedance at the second stub must be $Z_0$, so equating $Real\lbrace Y_2 \rbrace = 1/Z_0$ it gives:

\begin{equation}
G_L = Y_0\frac{1 + tan^2(\beta \cdot d)}{2tan^2(\beta \cdot d)} \lbrace 1 \pm \sqrt{1 - \frac{4tan^2(\beta \cdot d)(Y_0 - (B_L+B_{stub1})\cdot tan(\beta \cdot d))^2}{Y_0^2(1+tan^2(\beta \cdot d))^2}} \rbrace
\end{equation}

Notice here that those conductances which make the factor inside the square root negative cannot be matched. So, the \textit{double stub} method is limited to load conductances which meet the following condition:

\begin{equation}
G_L \leq \frac{Y_0}{sin^2(\beta \cdot d)}
\end{equation}

\noindent The susceptance of the first stub can be calculated as:
\begin{equation}
B_{stub_1} = - B_L + \frac{Y_0 \pm \sqrt{(1 + tan^2(\beta \cdot d))G_L\cdot Y_0 - (G_L \cdot tan(\beta \cdot d))^2}}{tan(\beta \cdot d)}
\end{equation}


\noindent Similarly, the susceptance of the second stub is:
\begin{equation}
B_{stub_2} = \frac{\pm\sqrt{Y_0\cdot G_L(1 + tan^2(\beta \cdot d)) - (G_L\cdot tan(\beta \cdot d))^2} + G_L \cdot Y_0}{G_L \cdot tan(\beta \cdot d)}
\end{equation}

\noindent Finally, the length of the stubs is given by:

\begin{align}
l_{open} & = \frac{\lambda}{2\pi} atan\left(Z_0\cdot B_{stub_i}\right)   & \text{Open stub}\\
l_{short} & = \frac{-\lambda}{2\pi} atan\left(\frac{1}{Z_0\cdot B_{stub_i}}\right) & \text{Short circuited stub}
\end{align}

\noindent where $i=\lbrace 1,2 \rbrace$ denotes the number of the stub.\\

\noindent As in \textit{single stub} method, the use of balanced stubs is possible:

\begin{table}[H]
  \centering
  \begin{tabular}{ | c | c | }
    \hline
    Open circuited stub & Short circuited stub\\ \hline
    \begin{minipage}{.4\textwidth}
      \includegraphics[width=\linewidth]{DoubleStubOpenBalanced}
    \end{minipage}
    &
    \begin{minipage}{.4\textwidth}
      \includegraphics[width=\linewidth]{DoubleStubShortBalanced}
    \end{minipage}
    \\ \hline
  \end{tabular}
  \caption{Double stub matching (balanced stubs)}\label{tbl:dblstubbalanced}
\end{table}

\noindent \textit{Reference} \cite{Pozar}, pages 241-246.

\subsection{$\lambda/4 + \lambda/8$ matching}
Another narrowband matching network technique is to combine a $\lambda/4$ and $\lambda/8$ transmission to match a complex impedance, $Z_L$ to real source impedance. The $\lambda/8$ line converts the complex impedance to a real one and the $\lambda/4$ line converts that intermediate real impedance into the source impedance, $Z_0$.

\begin{figure}[H]
\centering
\includegraphics[width=120mm]{Smithl8l4}
\caption{Example of $\lambda/4 + \lambda/8$ matching: $Z_S = 50\Omega$, $Z_L = 30+j50\Omega$, $Z_{\lambda/4} = 102.6\Omega$, $Z_{\lambda/4} = 58.3\Omega$}
\label{fig:SmithL8L4}
\end{figure}


\noindent Design equations:
\begin{align}
Z_{\lambda/8} & = \sqrt{R_L^2 + X_L^2} \\
Z_{\lambda/4} & = \sqrt{\frac{R_S \cdot R_L \cdot Z_{\lambda/8}}{Z_{\lambda/8}-X_L}}
\end{align}


\noindent \textit{Reference:} \cite{BahlFundamentalsRFMW}, pages 159-161.


\subsection{Multistage $\lambda$/4 sections}
Typically, broadband matching between real impedances at microwave frequencies is done with multisection transformers. This matching technique relies on the \textit{Theory of the small reflections} which states that the overall reflection coefficient of N cascaded transmission lines of the same length can be approximated as:

\begin{equation}
\Gamma(\theta) = \sum \limits_{n=0}^{N} \Gamma_n \cdot e^{-j\cdot 2n \theta}
\label{eq:CascadeReflection}
\end{equation}

\noindent where $\theta$ is the electrical length of a single transmission line (typically $\lambda/4$). The ${\Gamma_n}$ weigths define the shape of $\Gamma(\theta)$ and they are taylored so as to get a binomial or a Chebyshev overall response.

\noindent Once given $\Gamma_n \;\; \forall n \in [0, N]$, it is possible to calculate the impedance of each transmission line:

\begin{equation}
Z_{n+1} \sim Z_n \cdot e^{2\cdot\Gamma_n}
\end{equation}

\noindent where n indicates the section number.

\subsubsection{Binomial weighting}
\noindent $\Gamma_n$ is defined as:

\begin{equation}
\Gamma_n = A\cdot C^{N}_{n} \;\; \forall n \in [0, N]
\end{equation}

\noindent where $A = 2^{-N}\frac{Z_L - Z_0}{Z_L + Z_0}$ and $C^N_n = \frac{N!}{(N-n)!n!}$

\subsubsection{Chebyshev weighting}

\noindent The overall reflection coeffient is set to:

\begin{equation}
\Gamma(\theta) = A \cdot e^{-jN\theta} \cdot T_{\theta}(sec(\theta_m)cos(\theta))
\end{equation}

\noindent where:

\begin{equation}
 A = \frac{Z_L - Z_0}{Z_L + Z_0} \cdot \frac{1}{T_N(sec(\theta_m))}
\end{equation}

\begin{equation}
  sec(\theta_m) = cosh(\frac{1}{N} acosh\left( \frac{1}{\Gamma_m} \lvert \frac{Z_L - Z_0}{Z_L + Z_0} \rvert \right))
\end{equation}

\noindent and $T_N(x)$ is the Chebyshev polynomial of order N. The Chebyshev polinomials are defined such that:
\begin{equation}
 T_n(x) = 2xT_{n-1}(x) - T_{n-1}(x)
\end{equation}

\begin{equation}
T_1(x) = x
\end{equation}

\begin{equation}
T_0(x) = 1
\end{equation}

\noindent $T_N(sec(\theta_m)cos(\theta))$ involves terms such as $cos^N(x)$, $cos^{N-1}(x)$,... In order to equate this terms to the $\Gamma_n$ terms in \ref{eq:CascadeReflection}, it is necessary to expand $cos^N(x)$ terms into sums of terms such as $cos((n-2m)\theta)$

\noindent \textit{Reference:} \cite{Pozar}, pages 250-260.

\subsection{Cascaded L-sections}
An alternative method to achieve broadband matching between real impedances is to cascade N (lowpass) \textit{L-section} stages. In this sense, the \textit{Cascaded L-sections} method does N-1 matches between intermediate real impedances such that $R_i > R_{i+1} \forall i \in N$.

\begin{figure}[H]
\centering
\includegraphics[width=120mm]{CascadedLCsch}
\caption{Cascaded L-sections method}
\end{figure}

Depending on the values of the intermediate impedances, the bandwidth of the matching network will vary. In order to maximize it, the ratios of consecutive virtual resistances should be equal:

\begin{equation}
  \frac{R_S}{R_1} = ... = \frac{R_{i}}{R_{i+1}} = ... = \frac{R_{N-1}}{R_{L}}
\end{equation}

\noindent Thus, the intermediate virtual resistance is given by:

\begin{equation}
R_i = R_S^{\frac{N-i}{N}} \cdot R_L^{\frac{i}{N}}, \forall i \in [1, N-1]
\end{equation}


\noindent Once having $R_i$, the values of the inductors and the can be determined:
\begin{align}
Q_i & = \sqrt {\frac{R_{i-1}}{R_i}},\\
C_i & = \frac{Q_i}{\omega R_{i-1}}, \\
L_i & = \frac{Q_i R_i}{\omega},  \forall i \in [1, N-1]
\end{align}


\begin{figure}[H]
\centering
\includegraphics[width=120mm]{SmithCascadedLCsections}
\caption{Example of \textit{cascaded L-sections} matching: $Z_S = 50\Omega$, $Z_L = 150\Omega$, $L_i = \lbrace 5.3, 7.6, 11\rbrace nH$, $C_i = \lbrace 1.47, 1, 0.7 \rbrace pF$}
\end{figure}


\noindent \textit{Reference:} \cite{BahlFundamentalsRFMW}, pages: 169-172.
